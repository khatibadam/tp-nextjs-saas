generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id_user String @id @default(cuid())
  firstname String
  lastname String
  email String @unique()
  password String
  otpCodes OtpCode[]
  subscription Subscription?
  stripeCustomerId String? @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Subscription {
  id String @id @default(cuid())
  userId String @unique
  user User @relation(fields: [userId], references: [id_user], onDelete: Cascade)
  
  stripeSubscriptionId String? @unique
  stripeCustomerId String
  stripePriceId String
  stripeCurrentPeriodEnd DateTime?
  
  planType PlanType @default(FREE)
  status SubscriptionStatus @default(INACTIVE)
  storageLimit BigInt // en octets
  storageUsed BigInt @default(0)
  
  cancelAtPeriodEnd Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId])
  @@index([stripeCustomerId])
  @@index([stripeSubscriptionId])
}

enum PlanType {
  FREE
  STANDARD
  PRO
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  PAST_DUE
  CANCELED
  TRIALING
}

model OtpCode {
  id String @id @default(cuid())
  email String
  code String
  expiresAt DateTime
  verified Boolean @default(false)
  createdAt DateTime @default(now())
  
  user User? @relation(fields: [email], references: [email])
  
  @@index([email])
  @@index([code])
}